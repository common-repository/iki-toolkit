jQuery(document).ready(function(e){function t(){var t=e("#iki-del-ext-data"),a=e("#iki-del-success"),n=e("#iki-del-error"),o=e("#iki-del-ext-spinner").css("float","none"),s=window.ikiToolkitExports;t.on("click",function(){t.prop("disabled",!0),o.css({display:"inline-block"}),i(s.post.id,s.wpNonce,ajaxurl).done(function(e){a.show(),n.hide()}).fail(function(e){a.hide(),n.show()}).always(function(){o.css({display:"none"}),t.prop("disabled",!1)})})}function i(t,i,a){var n=e.Deferred(),o={action:"iki_delete_ext_cache",post_id:t,_ajax_nonce:i};return e.ajax({type:"POST",url:a,dataType:"json",timeout:1e4,data:o}).done(function(e,t,i){n.resolve()}).fail(function(e,t,i){n.reject()}),n.promise()}function a(){var t=e("#iki-data-success"),i=e("#iki-data-error"),a=i.data("ikiTimeout"),r=e("#iki-test-ext-spinner").css("float","none");n.on("click",function(){var c,d=o.val();switch(d){case"flickr":var l=e("#fw-option-external_service-flickr-username").val(),u=e("#fw-option-external_service-flickr-photoset_id").val();c=s.testFlickr(l,u);break;case"pinterest":var f=e("#fw-option-external_service-pinterest-username").val(),k=e("#fw-option-external_service-pinterest-boardname").val();c=s.testPinterest(f,k)}t.hide("fast"),i.hide("fast"),r.css("visibility","visible"),c&&(o.prop("disabled",!0),n.prop("disabled",!0),c.done(function(e){i.text(""),t.show(),t.text(e.message)}).fail(function(e){e.statusText&&"timeout"===e.statusText?i.text(a):i.text(e.message),t.text(""),i.show()}).always(function(){r.css("visibility","hidden"),o.prop("disabled",!1),n.prop("disabled",!1)}))})}var n,o;if(window.ikiToolkit){var s=Object.create(window.ikiToolkit.admin.ExternalApiValidator).init();s.setNonce(window.ikiToolkitExports.wpNonce),"undefined"!=typeof fwEvents&&fwEvents.on("fw:options:init",function(i){i.lazyTabsUpdated&&(n||(n=e("#iki-test-ext-data"),o=e("#fw-option-external_service-service"),n.length&&(a(),t())))})}}),jQuery(document).ready(function(e){}),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.admin=window.ikiToolkit.admin||{},window.ikiToolkit.admin.ExternalApiValidator=function(e){"use strict";function t(){return this.defaultData={flickr:"81703997@N00",pinterest:""},this}function i(e){this.nonce=e}function a(e,t,i,a){a&&(e=e.trim()?e:this.defaultData.flickr);var n={action:"iki_check_external_data",method:"get_user",service:"flickr",data:{user_id:e,cache:"disabled"}};return i&&(n.data.api_key=i),t.trim()&&(n.method="get_photoset_info",n.data.photoset_id=t),this._sendRequest(n)}function n(e,t){e=e.trim()?e:this.defaultData.pinterest;var i={action:"iki_check_external_data",method:"get_user_latest_pins",service:"pinterest",data:{user:e,cache:"disabled"}};return t.trim()&&(i.method="get_user_board",i.data.boardname=t),this._sendRequest(i)}function o(t){t._ajax_nonce=this.nonce;var i=e.Deferred();return e.ajax({type:"POST",url:ajaxurl,dataType:"json",timeout:15e3,data:t}).done(function(e,t,a){0===e?i.reject(e):(e=JSON.parse(e),e&&"failure"!==e.status?i.resolve(e):i.reject(e))}).fail(function(e,t,a){try{e=JSON.parse(e)}catch(e){}i.reject(e,t,a)}),i.promise()}return{testFlickr:a,testPinterest:n,sendRequest:o,init:t,setNonce:i,_sendRequest:o}}(jQuery),jQuery(document).ready(function(e){"use strict";function t(e,t,i,a){t.css("visibility","visible"),e.done(function(e){i.show(),i.text(t.data("ikiSuccess"))}).fail(function(e){e.status&&"failure"===e.status?a.text(e.message):e.statusText&&"timeout"===e.statusText?a.text(t.data("ikiTimeout")):a.text(t.data("ikiFailure")),i.text(""),a.show()}).always(function(){t.css("visibility","hidden")})}var i=Object.create(window.ikiToolkit.admin.ExternalApiValidator).init(),a=e("#iki-ajax-nonce").data("ikiNonce");i.setNonce(a);var n=e("#iki-flickr_api_key"),o=e("#iki-test-flickr-api"),s=o.children(".button"),r=o.children(".spinner"),c=o.children(".updated"),d=o.children(".error");s.on("click",function(e){e.preventDefault(),s.prop("disabled",!0),c.hide(),d.hide();var a=n.val();a=a.trim()?a:"fake_key_force_error";var o=i.testFlickr("","",a,!0);o.always(function(){s.prop("disabled",!1)}),t(o,r,c,d)})});