window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.ikiGridAdmin=window.ikiToolkit.ikiGridAdmin||{},window.ikiToolkit.ikiGridAdmin.AbstractRowView=function(i,t){"use strict";return Backbone.View.extend({events:{"click .iki-duplicate":"duplicateRow","click .iki-remove":"removeRow","click .iki-options":"toggleOptionsPanel","click .iki-close-options":"_closePanel"},duplicateRow:function(i){i.preventDefault(),window.ikiToolkit.ikiGridAdmin.rowViewEvents.trigger("duplicateRow",this.model.clone(),this)},removeRow:function(i){i.preventDefault(),this.model.destroy()},toggleOptionsPanel:function(i){i.preventDefault();var t=this;this.optionsPanelOpen?t._closePanel():this.$optionsPanel.show({duration:"fast",complete:function(){t.optionsPanelOpen=!0}})},_closePanel:function(){var i=this;this.$optionsPanel.hide({duration:"fast",complete:function(){i.optionsPanelOpen=!1}})}})}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.ikiGridAdmin=window.ikiToolkit.ikiGridAdmin||{},window.ikiToolkit.ikiGridAdmin.ClassicRowView=function(i,t){"use strict";return window.ikiToolkit.ikiGridAdmin.AbstractRowView.extend({tagName:"div",template:_.template(i("#iki-classic-row-tpl").html()),attributes:{class:"iki-row-wrapper"},events:function(){return _.extend({},window.ikiToolkit.ikiGridAdmin.AbstractRowView.prototype.events,{"click .iki-orientation-btn":"changeOrientation","click .iki-cell-btn":"changeCells"})},initialize:function(){this.listenTo(this.model,"change:cells",this.onCellChange),this.listenTo(this.model,"change:orientation",this.onOrientationChange),this.listenTo(this.model,"destroy",this.onDestroy),this.optionsPanelOpen=!1},changeOrientation:function(i){i.preventDefault(),this.model.set("orientation",i.currentTarget.value)},onOrientationChange:function(i,t){this.modifyOrientation(t,i.previous("orientation"))},modifyOrientation:function(i,t){if(this.$orientationBtns.removeClass("iki-ui-selected"),this.$orientationBtns.filter('[value="'+i+'"]').addClass("iki-ui-selected"),this.$row.addClass("iki-row-orientation-"+i),t)this.$row.removeClass("iki-row-orientation-"+t).addClass("iki-row-orientation-"+i);else switch(i){case"portrait":this.$row.removeClass("iki-row-orientation-square iki-row-orientation-landscape");break;case"square":this.$row.removeClass("iki-row-orientation-portfolio iki-row-orientation-landscape");break;case"landscape":this.$row.removeClass("iki-row-orientation-portfolio iki-row-orientation-square")}},onCellChange:function(i,t){this.modifyCells(t,i.previous("cells"))},changeCells:function(i){var t=i.currentTarget.value;this.model.set("cells",t)},modifyCells:function(i,t){this.$cellBtns.removeClass("iki-ui-selected"),this.$cellBtns.filter('[value="'+i+'"]').addClass("iki-ui-selected"),this.$row.empty(),this.$row.removeClass("iki-row-cells-"+t).addClass("iki-row-cells-"+i);for(var e=1;e<=i;e++){var o=this.$column.clone();this.$row.append(o)}},onDestroy:function(){this.remove()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$row=this.$(".iki-grid-row"),this.$column=this.$(".iki-grid-thumb").clone(),this.$optionsPanel=this.$(".iki-classic-row-ui"),this.$cellBtns=this.$(".iki-cell-btn"),this.$orientationBtns=this.$(".iki-orientation-btn"),1!==this.model.attributes.cells&&this.modifyCells(this.model.attributes.cells,1),this.modifyOrientation(this.model.attributes.orientation),this}})}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.ikiGridAdmin=window.ikiToolkit.ikiGridAdmin||{},window.ikiToolkit.ikiGridAdmin.GridRowView=function(i,t){"use strict";return Backbone.View.extend({events:{"click .iki-new-classic":"addClassicRow","click .iki-new-mixed":"addMixedRow"},addClassicRow:function(i){this.collection.add(new window.ikiToolkit.ikiGridAdmin.RowModel,i)},addMixedRow:function(){this.collection.add(new window.ikiToolkit.ikiGridAdmin.RowModel({type:"mixed",name:"mixed-1",cells:3}))},initialize:function(){this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"change:cells",this.onModelCellChange),this.$insertNewRowUI=this.$(".iki-insert-new-ui-wrap"),this.listenTo(window.ikiToolkit.ikiGridAdmin.rowViewEvents,"duplicateRow",this.onDuplicateRow),this.$gridDataField=i("#iki_grid_data"),this.$totalCells=i("#iki-total-cells"),this.totalCellCount=0,this.mixedRowsParsed=window.ikiToolkit.ikiGridAdmin.mixedRowsParsed;var t=this;i("#post").on("submit",function(){t.updateGridMetadata()})},onModelCellChange:function(i,t){this.totalCellCount+=Number(t)-Number(i.previousAttributes().cells),this._updateTotalCells(Number(this.totalCellCount))},onCollectionRemove:function(i){this.totalCellCount-=i.attributes.cells,this._updateTotalCells(this.totalCellCount)},_updateTotalCells:function(i){this.$totalCells.text(i)},onCollectionUpdate:function(){},updateGridMetadata:function(){0===this.collection.size()&&this.addClassicRow({silent:!0});var i=JSON.stringify(this.collection);this.$gridDataField.attr("value",i)},onDuplicateRow:function(i,t){this.$addAfter=t.$el,this.collection.add(i,{at:Number(t.$el.index())+1})},render:function(){this.addAll()},addOne:function(i){if("classic"===i.attributes.type){var t=new window.ikiToolkit.ikiGridAdmin.ClassicRowView({model:i,collection:this.collection});this.$addAfter?(this.$addAfter.after(t.render().el),this.$addAfter=null):this.$insertNewRowUI.before(t.render().el)}else if("mixed"===i.attributes.type){var e=new window.ikiToolkit.ikiGridAdmin.MixedRowView({model:i,collection:this.collection});this.$addAfter?(this.$addAfter.after(e.render().el),this.$addAfter=null):this.$insertNewRowUI.before(e.render().el)}this.totalCellCount+=Number(i.attributes.cells),this._updateTotalCells(this.totalCellCount)},addAll:function(){this.collection.each(this.addOne,this)},remove:function(){this.collection=null}})}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.ikiGridAdmin=window.ikiToolkit.ikiGridAdmin||{},window.ikiToolkit.ikiGridAdmin.MixedRowView=function(i,t){"use strict";return window.ikiToolkit.ikiGridAdmin.AbstractRowView.extend({tagName:"div",template:_.template(i("#iki-mixed-row-tpl").html()),attributes:{class:"iki-row-wrapper"},events:function(){return _.extend({},window.ikiToolkit.ikiGridAdmin.AbstractRowView.prototype.events,{"click .mixed-row-btn":"changeRow"})},initialize:function(){this.listenTo(this.model,"destroy",this.onDestroy),this.listenTo(this.model,"change:name",this.onChangeRow),this.mixedRowsParsed=window.ikiToolkit.ikiGridAdmin.mixedRowsParsed},changeRow:function(t){t.preventDefault();var e=i(t.currentTarget).data("ikiRow"),o=this.mixedRowsParsed[e].orientation.length;this.model.set("name",e),this.model.set("cells",o)},onChangeRow:function(i,t){this.attachRowImage(t)},onDestroy:function(){this.remove()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$row=this.$(".iki-grid-row"),this.$optionsPanel=this.$(".iki-classic-row-ui"),this.$mixedRowBtns=this.$(".mixed-row-btn"),this.$currentRowImg=this.$(".iki-current-row"),this.attachRowImage(this.model.get("name")),this},attachRowImage:function(i){var t=this.$mixedRowBtns.filter('[data-iki-row="'+i+'"]');if(this.$mixedRowBtns.removeClass("iki-selected"),t.addClass("iki-selected"),this.$currentRowImg=this.$(".iki-current-row"),t.length){var e=t.find("img").attr("src");this.$currentRowImg.attr("src",e),this.$currentRowImg.addClass(t.data("iki-row"))}}})}(jQuery,window),jQuery(document).ready(function(i){"use strict";window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.ikiGridAdmin=window.ikiToolkit.ikiGridAdmin||{};var t=window.ikiToolkit.ikiGridAdmin.RowModel=Backbone.Model.extend({defaults:{cells:4,orientation:"portrait",type:"classic",name:null,condensed:!1}});window.ikiToolkit.ikiGridAdmin.RowCollection=Backbone.Collection.extend({model:window.ikiToolkit.ikiGridAdmin.RowModel});var e=new window.ikiToolkit.ikiGridAdmin.RowCollection,o=JSON.parse(window.ikiAvailableMixedRows),n={};_.each(o.mixed,function(i,t){n[i.name]=i}),window.ikiToolkit.ikiGridAdmin.mixedRowsParsed=n,window.ikiToolkit.ikiGridAdmin.rowViewEvents={},_.extend(window.ikiToolkit.ikiGridAdmin.rowViewEvents,Backbone.Events),new window.ikiToolkit.ikiGridAdmin.GridRowView({el:"#iki-grid-wrapper",collection:e});var l=[];if(window.ikiGridMetaData&&window.ikiGridMetaData.length>0){var s=JSON.parse(window.ikiGridMetaData);_.each(s,function(i,e){"classic"===i.type?l.push(new t({type:"classic",cells:i.cells,orientation:i.orientation,name:null})):n[i.name]&&l.push(new t({type:"mixed",name:i.name,orientation:n[i.name].orientation,cells:n[i.name].orientation.length}))})}else l.push(new t);e.reset(l)});