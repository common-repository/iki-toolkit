window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external.externalService=function(t,i){"use strict";var e={};return e.init=function(e,a,o,r){this.data=e,this.app=a,this.api=o,this.api.init({token:e.options.external.token,adminUrl:window.ikiThemeExports.adminUrl}),this.userProfile=!1,e.options.external.userProfile&&(this.userProfile=e.options.external.userProfile),this.userImages=!1,e.options.external.userImages&&(this.userImages=e.options.external.userImages);var n=t("#iki-thumb-template").html(),s=_.template(n);this.appData=t.extend({},e.options.external,{userProfile:this.userProfile,userImages:this.userImages,startPage:2,imagesContainer:t(".iki-external-images"),loadMoreBtn:t(".iki-progress-btn"),api:o,thumbTemplate:s,thumbAnim:e.thumbAnim,thumbAnimStagger:180,$menu:t("#iki-main-nav-wrap"),lightboxData:i.ikiThemeExports.theme.options.lightbox.data,fullWidth:!1}),this.initializeApp()},e.initializeApp=function(){this.app.init(this.appData)},e}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external.AbstractApp=function(t,i){"use strict";function e(e){var a={thumbAnim:"transition.perspectiveUpIn",thumbAnimStagger:100,scrollAnimDuration:700};this.data=t.extend({},a,e);var o=/administrator|author|editor/;this.showAlerts=o.test(ikiThemeExports.theme.options.user_roles),this.extLinkText=i.ikiThemeExports.module.ext_link_text,this.assetIndex=1,this.totalAssets=0,this.userProfile=e.userProfile,this.userImages=e.userImages,this.token=e.token,this.useLocalConnection=e.useLocalConnection,this.userName=e.userName,this.currentPage=this.data.startPage,this.currentBatch=0,this.pageIterator=Object.create(i.ikiToolkit.external.PageIterator),this.api=this.data.api,this.pageBuilder=Object.create(i.ikiToolkit.external.PageBuilder),this.$loadMoreBtn=this.data.loadMoreBtn,this.laddaBtn=void 0,i.ikiThemes.progressBtn&&(this.laddaBtn=Object.create(i.ikiThemes.progressBtn),this.laddaBtn.init(this.$loadMoreBtn)),this.animator=void 0,i.ikiThemes.utils.Animator&&(this.animator=Object.create(i.ikiThemes.utils.Animator),this.animator.init({animationIn:this.data.thumbAnim,stagger:this.data.stagger})),this.$body=t("body"),this.checkBodyScroll=!0,this.$placeholders=this.data.imagesContainer.find(".iki-ext-placeholder"),this._checkExportDataError(this.userProfile).error||this.userProfile&&this.populateUserProfile(this.userProfile.data);var r=this._checkExportDataError(this.userImages);if(r.error)return this._alertDataError(r),!1;this.latestData=this.userImages,this.pageIterator.init(this.userImages.data,this.data.imagesPerPage),this.loadMore(null,!0),this.laddaBtn&&this.laddaBtn.setText(this.$loadMoreBtn.data("inProgress")),this.loadMoreBinded=this.loadMore.bind(this),this.$loadMoreBtn.on("click",this.loadMoreBinded),i.ikiThemes&&this._initLightbox()}function a(t,i){return'<strong><a class="iki-lb-ext-link" target="_blank" href="'+t+'">'+i+"</a></strong>"}function o(i){i.message&&i.message.trim()&&this.showAlerts&&(t("body").addClass("iki-ext-error"),t(".iki-external-images").find(".iki-ext-placeholder"),t.magnificPopup.open({items:{src:'<div class="iki-ext-notification clearfix"><p class="iki-ext-message">'+i.message+"</p></div>",type:"inline"},callbacks:{open:function(){t(".mfp-close").insertBefore(".iki-ext-message")}}})),this.laddaBtn&&(this.laddaBtn.setText(this.$loadMoreBtn.data("error")),this.laddaBtn.stop())}function r(){return{error:!1,message:"",status:""}}function n(e){var a=new t.Deferred;this.currentBatch++,e=this.processNextImageData(e);var o=this,r=e.length,n=0;o._trimMaxImages(e,o.totalAssets,o.data.maxTotal),o.totalAssets+=r;var s=t("<div></div>").css("display","none").attr("id","iki-batch-wrapper"-+this.currentBatch),l=t(this.pageBuilder.buildUserImages(e,this.data.thumbTemplate));return s.append(l),_.defer(function(){s.imagesLoaded().always(function(e){o.laddaBtn&&(o.laddaBtn.stop(),o.laddaBtn.setText(o.laddaBtn.originalText)),o.data.imagesContainer.append(l),s.remove(),o.$placeholders.remove();var r=l.filter(".iki-thumb-container");r.find(".tooltip-js").tooltipster(t.extend({},i.ikiToolkit.defaultTooltipOptions,{position:"top"})),r.find(".close-tt-js").on("click",function(i){i.preventDefault(),t(this).tooltipster("close")}),a.resolve(r,t(r.get(0)))}).progress(function(t,i){n++,o.laddaBtn&&o.laddaBtn.setProgress(n/r*100)})}),t("body").append(s),a.promise()}function s(){this.laddaBtn&&(this.laddaBtn.disable(),this.laddaBtn.setText(this.$loadMoreBtn.attr("data-all-loaded")))}function l(){this.$loadMoreBtn.attr({disabled:!0})}function d(){this.$loadMoreBtn.attr({disabled:!1})}function c(t){var e=this.buildUserProfileData(t);ikiThemeExports.module.show_profile&&(this.pageBuilder.buildUserProfile(e),i.PubSub.publish("iki_profile_populated",e))}function h(t){throw new Error("buildUserProfileData method is abstract")}function u(t,i){var e=this;t&&t.preventDefault(),i=i||!1,this.laddaBtn&&(e.laddaBtn.start(),e.laddaBtn.setText(this.$loadMoreBtn.data("inProgress"))),e.pageIterator.hasNext()?e.buildNewImages(e.pageIterator.next()).done(function(t,a){e.imagesBuildDone(t,a,i)}):e.getAssets().done(e.assetsLoadSuccess.bind(e)).fail(e.assetsLoadFailure.bind(e))}function k(e,a,o){var r=this,n=t.Deferred();o=o||!1,r.disableUi();var s=parseInt(a.css("margin-left"),10);if(i.ikiThemes&&(s+=+i.ikiThemes.State.wpAdminBarSize,i.ikiThemes.State.activeMenu.isSticky)){var l=r.$body.scrollTop(),d=parseInt(i.ikiThemeExports.theme.layout.header.hide_at);isNaN(d)&&(d=1e7),r.checkBodyScroll&&d&&l<d?s+=i.ikiThemes.State.activeMenu.isSticky?r.data.$menu.height():0:r.checkBodyScroll=!1}return o?r.animator?r.animator.animate(e,null,"inline-block").done(function(){n.resolve()}):(e.css("opacity",1),n.resolve()):_.defer(function(){t.fn.velocity?a.velocity("scroll",{offset:-1*s+"px",duration:r.data.scrollAnimDuration,complete:function(){r.animator?r.animator.animate(e,null,"inline-block").done(function(){n.resolve()}):n.resolve()}}):n.resolve()}),n.promise()}function p(){throw new Error("This method needs to be extended (abstract)")}function m(t,i,e){t.length+i>e&&t.splice(e-i,t.length)}function f(t,i,e){var a=this;return a.currentPage++,a.latestData=t,a._trimMaxImages(a.latestData.data,a.totalAssets,a.data.maxTotal),a.pageIterator.setNewData(a.latestData.data,a.data.imagesPerPage),this.buildNewImages(a.pageIterator.next()).done(function(t,i){a.disableUi();var e=a.data.disablePaging||a.totalAssets>=a.data.maxTotal;a.animateImages(t,i).done(function(){a.data.disablePaging||a.checkIfEnd()||e?a.theEnd():a.enableUi()})})}function g(t,i,e){this._alertDataError(this._checkExportDataError(t)),this.laddaBtn&&(this.laddaBtn.setText(this.$loadMoreBtn.data("error")),this.laddaBtn.stop())}function x(t,i,e){var a=this;this.disableUi(),this.firstBatch||(this.firstBatch=!0);var o=a.data.disablePaging||this.totalAssets>=this.data.maxTotal;this.animateImages(t,i,e).done(function(){o||a.checkIfEnd()?a.theEnd():a.enableUi()})}function w(){return!this.pageIterator.hasNext()}function T(i){var e=t.magnificPopup.instance;return this.lightBox&&this.lightBox.isOpen&&e.updateItemHTML(),i}function b(){return t(".iki-external-images")}function P(i){var e=t.magnificPopup.instance;this.lightBox&&this.lightBox.isOpen&&e.items.push({src:i})}function v(){return this.assetIndex++}function B(){this.lightBox=Object.create(i.ikiThemes.Lightbox),this.lightBox.init({lightbox:{$targets:this.getLightBoxTargets(),animations:this.data.lightboxData.animations,openCloseAnimation:this.data.lightboxData.openCloseAnimation},mfp:{image:{titleSrc:function(t){var i=t.el.parent().siblings(".iki-desc").html();return i&&i.trim().length||(i=t.el.parent().parent().siblings(".iki-thumb-title").text()),i}}}})}return{init:e,buildNewImages:n,theEnd:s,populateUserProfile:c,buildUserProfileData:h,loadMore:u,animateImages:k,getAssets:p,assetsLoadSuccess:f,assetsLoadFailure:g,imagesBuildDone:x,checkIfEnd:w,processNextImageData:T,disableUi:l,enableUi:d,getLightBoxTargets:b,updateLightBox:P,getNextIndex:v,_initLightbox:B,_trimMaxImages:m,_checkExportDataError:r,_alertDataError:o,_createExternalLink:a}}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external.flickr=function(t,i){"use strict";var e=Object.create(i.ikiToolkit.external.externalService);return e.init=function(t){var e=Object.create(i.ikiToolkit.external.flickr.Main),a=Object.create(i.ikiToolkit.external.flickr.Api);i.ikiToolkit.external.externalService.init.call(this,t,e,a,null)},e.initializeApp=function(){this.userImages&&"ok"===this.userImages.stat&&(this.data.options.external.showStream?this.api.remapStreamPhotoData(this.userImages,!0):this.api.remapPhotosetPhotoData(this.userImages,!0),this.userProfile&&"ok"===this.userProfile.stat&&this.api.remapUserData(this.userProfile,!0)),i.ikiToolkit.external.externalService.initializeApp.call(this)},e}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external.PageBuilder=function(t,i){function e(e){var a=t(".iki-ext-profile"),o=t("<a></a>").attr({href:e.home_url,target:"_blank",class:"iki-ext-profile-link"}),r=t([]);if(e.imgSrc?(r=t("<img/>").attr({src:e.imgSrc}),e.home_url?(o.append(r),a.append(o)):a.append(r),delete e.imgSrc):(r=a.find("img"),e.home_url&&r.length&&(o.append(r),a.append(o))),r.length&&o.length){var n=o.attr("href");r.attr("title",n).tooltipster(i.ikiToolkit.defaultTooltipOptions)}a.imagesLoaded().done(function(){_.defer(function(){a.velocity("transition.slideUpIn",{duration:500}),t(i).trigger("iki_external_profile_image_loaded")})}),delete e.home_url,_.each(e,function(i,e){t("span[data-iki-"+e+"]").html(i).parent().css("display","inline-block")})}function a(i,e){var a="";return _.each(i,function(t){a+=e(t)}),t.parseHTML(a)}return{buildUserProfile:e,buildUserImages:a}}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external.PageIterator=function(t,i){function e(t,i){this.data=t,this.index=0,this.perPage=i}function a(){return this.index<this.data.length}function o(){var t=this.data.slice(this.index,this.index+this.perPage);return this.index=this.index+this.perPage,t}function r(){this.index=0}function n(t,i){this.perPage=i||this.perPage,this.data=t,this.reset()}return{init:e,hasNext:a,next:o,reset:r,setNewData:n}}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external.pinterest=function(t,i){"use strict";var e=Object.create(i.ikiToolkit.external.externalService);return e.init=function(t){var e=Object.create(i.ikiToolkit.external.pinterest.Main),a=Object.create(i.ikiToolkit.external.pinterest.Api);i.ikiToolkit.external.externalService.init.call(this,t,e,a,null)},e.initializeApp=function(){this.userImages&&this.userImages.channel&&this.userImages.channel.item&&this.api.remapPhotoData(this.userImages,!0),i.ikiToolkit.external.externalService.initializeApp.call(this)},e}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external.flickr=window.ikiToolkit.external.flickr||{},window.ikiToolkit.external.flickr.Api=function(t,i){"use strict";function e(t){this.imageSizes={s:"s",q:"q",t:"t",m:"m",n:"n",z:"z",c:"c",b:"b",o:"o",i:"-"},this.accessToken=t.token,this.adminAjaxUrl=t.adminUrl,this.endPoints={getUser:"https://api.flickr.com/services/rest?method=flickr.people.getInfo",getUserPhotos:"https://api.flickr.com/services/rest/?method=flickr.people.getPublicPhotos",getPhotosetInfo:"https://api.flickr.com/services/rest/?method=flickr.photosets.getInfo",getPhotosetPhotos:"https://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos",findByUsername:"https://api.flickr.com/services/rest/?method=flickr.people.findByUsername",lookupUser:"https://api.flickr.com/services/rest?method=flickr.urls.lookupUser"}}function a(t,i){var e=this.endPoints.getUser;e+="&user_id="+t;var a=this;return c(e+this.buildParams(i)).done(function(t,i,e){t.person.profileImageSrc=a.getProfilePhotoSrc(t.person)})}function o(t,i){var e=this.endPoints.getUserPhotos;return e+="&user_id="+t,c(e+this.buildParams(i))}function r(t){return c(this.endPoints.getPhotosetInfo+this.buildParams(t))}function n(t){return c(this.endPoints.getPhotosetPhotos+this.buildParams(t))}function s(t){return c(this.endPoints.findByUsername+this.buildParams(t))}function l(t,i){t.indexOf("flickr.com")<0&&(t="https://www.flickr.com/photos/"+t);var e=this.endPoints.lookupUser;return e+="&url="+t,c(e+this.buildParams(i))}function d(i){var e="&format=json";return e+="&api_key="+this.accessToken,e+="&jsoncallback=?",i?(t.each(i,function(t,i){e+="&"+t+"="+i}),e):e}function c(i){var e=t.Deferred();return t.ajax({type:"GET",url:i,dataType:"jsonp",timeout:1e4}).done(function(t,i,a){0===t||"fail"===t.stat?(i="failure",e.reject(t,i,a)):e.resolve(t,i,a)}).fail(function(t,i,a){t.message=t.message||"Request Timeout",e.reject(t,i,a)}),e.promise()}function h(t){var i="";return Number(t.iconserver)>0&&(i=u(t)),i}function u(t){return"https://farm"+t.iconfarm+".staticflickr.com/"+t.iconserver+"/buddyicons/"+t.nsid+".jpg"}function k(t,i){return t.data=t.person,t.data.username=t.data.nsid,i&&delete t.person,t}function p(t,i){return t.data=t.photos.photo,i&&delete t.photos.photo,t}function m(t,i){return t.data=t.photoset.photo,i&&delete t.photoset.photo,t}function f(t,i){return"https://farm"+t.farm+".staticflickr.com/"+t.server+"/"+t.id+"_"+t.secret+"_"+i+".jpg"}function g(t,i){return"https://www.flickr.com/photos/"+i+"/"+t.id}return{init:e,getUser:a,getUserPhotos:o,getPhotosetInfo:r,getPhotosetPhotos:n,findByUsername:s,getProfilePhotoSrc:h,constructUserProfileImgSrc:u,remapStreamPhotoData:p,remapUserData:k,getPhotoSrc:f,remapPhotosetPhotoData:m,findByUrl:l,buildParams:d,getPhotoUrl:g}}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external.flickr=window.ikiToolkit.external.flickr||{},window.ikiToolkit.external.flickr.Main=function(t,i){"use strict";function e(t){var i=this._checkExportDataError(t.userProfile);if(i.error){this.$loadMoreBtn=t.loadMoreBtn,this.laddaBtn=Object.create(window.ikiToolkit.progressBtn),this.laddaBtn.init(this.$loadMoreBtn);var e=/administrator|author|editor/;return this.showAlerts=e.test(ikiThemeExports.theme.options.user_roles),this._alertDataError(i),!1}window.ikiToolkit.external.AbstractApp.init.call(this,t)}function a(t){var i={error:!1,message:"",status:""};return t?"fail"===t.stat&&(i.error=!0,i.message=t.message,i.status=t.code):i.error=!0,i}function o(t,i,e){window.ikiToolkit.external.AbstractApp.assetsLoadSuccess.call(this,t,i,e)}function r(){return window.ikiToolkit.external.AbstractApp.checkIfEnd.call(this)}function n(t){return t.avatar_url=t.profileImagesSrc=this.api.getProfilePhotoSrc(t),{imgSrc:!this.data.customProfile&&t.avatar_url,home_url:t.profileurl._content,"images-count":t.photos.count._content}}function s(){var i=t.Deferred();return setTimeout(function(){i.reject()},100),i.promise()}function l(t){var i=this;return _.each(t,function(t,e){t.ikiThumbSrc=i.data.highResolution?i.api.getPhotoSrc(t,i.api.imageSizes.z):i.api.getPhotoSrc(t,i.api.imageSizes.n),t.ikiTitle=t.title,t.ikiDescription="",t.ikiThumbId=i.getNextIndex(),t.ikiLargeSrc=i.api.getPhotoSrc(t,i.api.imageSizes.b),t.ikiExtLink=i.api.getPhotoUrl(t,i.userProfile.data.nsid),t.ikiTitle.length&&(t.ikiDescription='<span class="iki-lb-title">'+t.ikiTitle+"</span>"),t.ikiDescription+=i._createExternalLink(t.ikiExtLink,i.extLinkText),i.updateLightBox(t.ikiLargeSrc)}),window.ikiToolkit.external.AbstractApp.processNextImageData.call(this),t}var d=Object.create(window.ikiToolkit.external.AbstractApp);return d.init=e,d.assetsLoadSuccess=o,d.checkIfEnd=r,d.buildUserProfileData=n,d.getAssets=s,d.processNextImageData=l,d._checkExportDataError=a,d}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external.pinterest=window.ikiToolkit.external.pinterest||{},window.ikiToolkit.external.pinterest.Api=function(t,i){"use strict";function e(t){this.accessToken=t.token,this.adminAjaxUrl=t.adminUrl,this.endPoints={getUserLatestPins:"https://pinterest.com/{username}/feed.rss",getUserBoard:"https://pinterest.com/{username}/{boardname}.rss"}}function a(t,i){}function o(t,i){return t.data=t.channel.item,i&&delete t.channel.item,t}function r(i,e){var a=t(i.description).find("img").attr("src"),o="/192x/";return-1!==a.indexOf(this.size.M)&&(o=this.size.M),a=a.replace(o,e)}function n(t){return s({user:t,method:"getUserLatestPins"})}function s(e){var a=t.Deferred();e.cache="disabled";var o={action:"iki_external_api",method:e.method,service:"pinterest",data:e,_ajax_nonce:i.ikiThemeExports.iki_nonce};return t.ajax({type:"POST",url:window.ikiThemeExports.adminUrl,dataType:"json",timeout:1e4,data:o}).done(function(t,i,e){0===t||t.error||t.message?(i="failure",a.reject(t,i,e)):a.resolve(t,i,e)}).fail(function(t,i,e){a.reject(t,i,e)}),a.promise()}return{init:e,getUserLatestPins:n,remapUserData:a,getPhotoSrc:r,remapPhotoData:o,size:{S:"/192x/",M:"/236x/",L:"/550x/",XL:"/736x/"}}}(jQuery,window),window.ikiToolkit=window.ikiToolkit||{},window.ikiToolkit.external=window.ikiToolkit.external||{},window.ikiToolkit.external.pinterest=window.ikiToolkit.external.pinterest||{},window.ikiToolkit.external.pinterest.Main=function(t,i){"use strict";function e(t){t.customProfile&&(t.userProfile=t.userImages,this.userProfile=!0),window.ikiToolkit.external.AbstractApp.init.call(this,t)}function a(t){var i={error:!1,message:"",status:""};return t?t.message&&(i.error=!0,i.message=t.message):i.error=!0,i}function o(t,i,e){window.ikiToolkit.external.AbstractApp.assetsLoadSuccess.call(this,t,i,e)}function r(){return window.ikiToolkit.external.AbstractApp.checkIfEnd.call(this)}function n(){var t=this;this.$loadMoreBtn.removeAttr("disabled"),this.laddaBtn&&this.laddaBtn.setText(this.$loadMoreBtn.attr("data-all-loaded")),this.$loadMoreBtn.off("click",this.loadMoreBinded),this.$loadMoreBtn.on("click",function(i){i.preventDefault(),window.open(t.userImages.channel.link,"_blank")})}function s(t){var i="";try{i=this.userImages.channel.link}catch(t){}return{home_url:i}}function l(){}function d(i){var e=this,a=/<\/a>\s*(.+)/;return _.each(i,function(i){var o=e.api.getPhotoSrc(i,e.api.size.XL);i.ikiThumbSrc=o,i.ikiExtLink=i.link,i.ikiLargeSrc=o,i.ikiThumbId=e.getNextIndex(),i.ikiTitle="",i.ikiDescription=i.description;var r=i.description.match(a);if(r){var n=t("<div/>").html(r[1]).text();n=n?n.trim():"",i.ikiDescription='<span class="iki-lb-title">'+n+"</span>",i.ikiTitle=n}i.ikiDescription+=e._createExternalLink(i.ikiExtLink,e.extLinkText),e.updateLightBox(i.ikiLargeSrc)}),i}var c=Object.create(window.ikiToolkit.external.AbstractApp);return c.init=e,c.assetsLoadSuccess=o,c.checkIfEnd=r,c.buildUserProfileData=s,c.getAssets=l,c.processNextImageData=d,c.theEnd=n,c._checkExportDataError=a,c}(jQuery,window);